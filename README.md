# ClipGuard

ClipGuard — отдельный защищенный буфер обмена. Данные хранятся в одном слоте, шифруются AES‑256 (AES‑GCM) и лежат в папке приложения. На каждое копирование/вставку выводится окно подтверждения, ведется JSONL‑лог с временем, типом операции и зашифрованным содержимым. Ключ шифрования - пароль, который создает пользователь, хранится в PBKDF2 хеше.

Важно: приложение **не использует системный буфер обмена Windows**. Это полностью автономная система со своим хранилищем.

## Структура (Готовая сборкаа есть в Releases)

Минимальная, но модульная структура: один `Main.cs` и три папки (`crypto`, `core`, `styles`).

```
ClipGuard.csproj                      — проект WPF (.NET 8) и параметры сборки
Main.cs                               — весь UI, окна, hotkeys и связывание логики
README.md                             — описание проекта и структуры
crypto/                               — криптография и работа с паролями
  AesGcmEncryptionService.cs          — AES‑GCM шифрование/дешифрование буфера
  PasswordService.cs                  — создание и проверка хеша пароля
core/
  Interfaces.cs                       — список возможностей модулей: хранение буфера, шифрование, лог, настройки, пароль. Что и как принимают, чтоо и как возвращают.
  Models.cs                           — модели настроек, буфера, логов. Структуры, в которых приложение хранит и передает данные между частями кода.
  Services.cs                         — Реальные реализации интерфейсов-модулей: хранилище, логирование, настройки.
styles/
  Theme.xaml                          — палитра и стили интерфейса
```

## Архитектура и поток данных

- Один защищенный слот: каждое копирование перезаписывает предыдущие данные.
- Каждая операция требует подтверждения пользователя.
- Пароль нужен только для расшифровки (вставки) и просмотра лога.
- Системный буфер Windows не используется.

### Копирование (Alt + N)
1. Пользователь подтверждает доступ.
2. Вводит данные вручную или перетаскивает текст в окно.
3. Данные шифруются AES‑GCM и сохраняются в `secure-clipboard.json`.
4. В лог пишется запись с типом `ctrl c`.

### Вставка (Alt + M)
1. Пользователь подтверждает доступ.
2. Вводит пароль.
3. Данные расшифровываются и показываются в окне вставки.
4. Можно выделить текст и перетащить его в целевое приложение.
5. В лог пишется запись с типом `ctrl v`.

## Криптография

- **Хеш пароля**: PBKDF2 (Rfc2898DeriveBytes) с SHA‑256, 150 000 итераций, соль 16 байт, хэш 32 байта.
- **Шифрование буфера**: AES‑GCM (256‑битный ключ), nonce 12 байт, tag 16 байт.
- **Ключ шифрования**: PBKDF2 (SHA‑256, 150 000 итераций, соль 16 байт), 32 байта.

## Логирование

Формат: JSONL (одна запись на строку). Поля: время, тип операции, содержимое буфера.

Пример записи (в файле хранится зашифрованное содержимое):

```json
{"timestamp":"2025-01-12T10:15:30.123+00:00","operation":"ctrl c","content":"enc:eyJjaXBoZXJ0ZXh0QmFzZTY0IjoiLi4uIn0="}
```

В интерфейсе (после ввода пароля) лог показывается расшифрованным:

```
10:15:30 ctrl c — example
```

При смене пароля лог автоматически перешифровывается новым паролем.

## Данные и файлы

- `AppData\Roaming\ClipGuard\secure-clipboard.json` — зашифрованные данные буфера.
- `AppData\Roaming\ClipGuard\settings.json` — настройки (хоткеи, хэш пароля, соль).
- `AppData\Roaming\ClipGuard\activity-log.jsonl` — зашифроанный лог в JSONL.

## Хоткеи по умолчанию (можно менять в настройках)

- `Alt + N` — сохранить в защищенный буфер.
- `Alt + M` — открыть защищенный буфер.

## UI / UX особенности

- Две вкладки: **Главная** (лог) и **Настройки** (горячие клавиши + пароль).
- Перетаскивание:
  - из окна вставки — drag‑and‑drop текста в целевое поле;
  - в окно копирования — drag‑and‑drop текста из другого приложения.

## Сборка и запуск (Готовая сборка есть в Releases)

Проект рассчитан на Windows (.NET 8, WPF).

### Запуск из исходников
```
dotnet run
```

### Portable (single‑file)
```
dotnet publish -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true /p:IncludeNativeLibrariesForSelfExtract=true
```
